# This file was generated by Chef for {{ fqdn }}
# Do NOT modify this file by hand!

<VirtualHost *:{{ munin_web_server_port }}>
  ServerAdmin   {{ munin_sysadmin_email }}
  ServerName    {{ ansible_fqdn }}
  ServerAlias   munin {{ munin_public_domain }}
  Alias         /munin {{ munin_htmldir }}
  DocumentRoot  {{ munin_htmldir }}
  CustomLog     {{ apache_log_dir }}/munin_access.log combined
  ErrorLog      {{ apache_log_dir }}/munin_error.log

{% case munin_server_auth_method %}
{% when 'openid' %}
  <Location />
    AuthName "Munin Server"
    AuthType OpenID
    require user {{ apache_allowed_openids | join(' ') }}
    AuthOpenIDDBLocation {{ apache_mod_auth_openid_dblocation }}
  </Location>
{% when 'open' %}
  <Location />
    AuthType None
  </Location>
{% else %}
  <Location />
    AuthName "Munin Server"
    AuthType Basic
    AuthUserFile "{{ munin_basedir }}/htpasswd.users"
    require valid-user
  </Location>
{% end %}

  RewriteEngine On
  RewriteCond %{THE_REQUEST} ^[A-Z]{3,9}\ /.*index\.html\ HTTP/
  RewriteRule ^(.*)index\.html$ $1 [R=301,L]
</VirtualHost>

